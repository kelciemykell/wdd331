(()=>{"use strict";var e,t={40789:(e,t,i)=>{var r=i(67294),a=i(73935),n=i(94184),s=i.n(n),o=["callout","list"],c=i(42286),l=i(16931),u=i(85893);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,r=m(e);if(t){var a=m(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return g(this,i)}}function g(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?y(e):t}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}chrome.extension.getBackgroundPage();const v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(h,e);var t,i,a,n=f(h);function h(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(t=n.call(this,e)).outerContainer=(0,r.createRef)(),t.container=(0,r.createRef)(),t.doodleCanvas=(0,r.createRef)(),t.layerCanvas=(0,r.createRef)(),t.textareaOut=(0,r.createRef)(),t.textarea=(0,r.createRef)(),t.listDialog=(0,r.createRef)(),t.fileInput=(0,r.createRef)(),t.state={isInCropMode:!1,currentTool:"",currentColor:"rgb(255, 0, 0)",currentPenWidth:4,currentFontSize:32,currentFontFamily:"Times New Roman",cropWidth:0,cropHeight:0,resizeWidth:0,resizeHeight:0,resizeProportional:!0,currentScale:1,canUndo:!1,canRedo:!1,canClear:!1,canDeleteSelected:!0,isShownUpgrade:!1,isReady:!1,upgradeType:"",isTextBackground:!1,isPremium:!1,currentShape:"",changeShape:!1},t.handleFileInputChange=t.handleFileInputChange.bind(y(t)),t.editor_style_callback=t.editor_style_callback.bind(y(t)),t.initEditor=t.initEditor.bind(y(t)),t.insertImage=t.insertImage.bind(y(t)),t.finishEdit=t.finishEdit.bind(y(t)),t.handleKeyDown=t.handleKeyDown.bind(y(t)),t.handleCloseUpgrade=t.handleCloseUpgrade.bind(y(t)),t.handleTextBgChange=t.handleTextBgChange.bind(y(t)),t.handleResetList=t.handleResetList.bind(y(t)),t.getQueryVariable=t.getQueryVariable.bind(y(t)),t}return t=h,(i=[{key:"componentDidMount",value:function(){this.initEditor(this.props.imageUrl),document.addEventListener("keydown",this.handleKeyDown),this.props.onRef(this)}},{key:"handleDrawStyle",value:function(e){var t=this;if("undo"===e.type)this.state.isReady&&this.editor.undo();else if("premiumPlan"===e.type)this.setState({isPremium:!e.value});else if("clear"===e.type)this.editor.clear();else if("deleteSelected"===e.type)this.state.isReady&&this.editor.deleteSelected();else if("save"===e.type)if("true"==this.getQueryVariable("incognito")){var i=this.editor.getImageDataURL(this.props.contentType);this.props.handleFinishEdit(e.type,i)}else this.editor.getImageDataBlob(this.props.contentType,(function(i){t.props.handleFinishEdit(e.type,i)}));else if("copy"===e.type)this.editor.getImageDataBlob(this.props.contentType,(function(i){t.props.handleFinishEdit(e.type,i)}));else if("style"===e.type){var r=e.shape,a=e.style;if(this.state.isReady)if(this.state.currentShape.length>0&&this.state.currentShape!==r&&(this.setState({changeShape:!0}),this.editor.unSelectAll()),"insertImage"===r){if(!this.state.isPremium)return void this.setState({upgradeType:"insertImage",isShownUpgrade:!0});a.name&&this.insertImage(a.name)}else if("image"===r){if(!this.state.isPremium)return void this.setState({upgradeType:"image",isShownUpgrade:!0});if(a.name){var n="./images/svg/"+a.name+".svg";this.insertImage(n)}}else{if(!this.state.isPremium&&("callout"==r||"list"==r))return void this.setState({upgradeType:r,isShownUpgrade:!0});if(this.editor.setPenType(r),"rect_blur"!==r){var s=e.changeType;2==s?a.color&&this.editor.setPenColor(a.color):(3==s||a.color&&this.editor.setPenColor(a.color),"text"!==r&&"callout"!==r?a.width&&this.editor.setPenWidth(a.width):a.width&&(this.editor.setFontSize(a.width),this.editor.setPenWidth(4)))}}else{if(!this.state.isPremium&&("callout"==r||"list"==r||"image"==r||"insertImage"==r))return void this.setState({upgradeType:r,isShownUpgrade:!0});"image"!==r&&"insertImage"!==r&&(this.state.currentTool=r),a.color&&(this.state.currentColor=a.color),"text"!==r&&"callout"!==r?a.width&&(this.state.currentPenWidth=a.width):a.width&&(this.state.currentFontSize=a.width,this.state.currentPenWidth=4)}}}},{key:"componentDidUpdate",value:function(e){e.imageUrl!==this.props.imageUrl&&""===e.imageUrl&&this.initEditor(this.props.imageUrl)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),this.editor=null}},{key:"handleKeyDown",value:function(e){var t=e.keyCode;if(-1!==this.props.className.indexOf("active"))if(90===t&&(e.ctrlKey||e.metaKey))e.shiftKey?this.editor.redo():this.editor.undo();else if((46===t||8===t)&&this.state.canDeleteSelected){if(e.target.classList.contains("editor-textarea"))return;this.editor.deleteSelected()}}},{key:"handleCloseUpgrade",value:function(){this.setState({isShownUpgrade:!1});var e=this.getQueryVariable("mark");window.parent.postMessage({type:"closeModel",mark:e,data:"closeModel"},"*")}},{key:"finishEdit",value:function(e,t){}},{key:"handleResetList",value:function(){this.editor.resetList()}},{key:"handleTextBgChange",value:function(){this.editor.setTextBackground(!this.state.isTextBackground),this.setState({isTextBackground:!this.state.isTextBackground})}},{key:"handleResizeProportionChange",value:function(e){this.setState({resizeProportional:e.target.checked})}},{key:"handleResizeInputChange",value:function(e,t){var i=this.editor.bg_info.width/this.editor.bg_info.height;"width"===e?!0===this.state.resizeProportional?this.setState({resizeWidth:parseInt(t.target.value),resizeHeight:parseInt(t.target.value)/i}):this.setState({resizeWidth:parseInt(t.target.value)}):!0===this.state.resizeProportional?this.setState({resizeWidth:parseInt(t.target.value)*i,resizeHeight:parseInt(t.target.value)}):this.setState({resizeHeight:parseInt(t.target.value)})}},{key:"getResizeInfo",value:function(){var e=this.editor.bg_info;this.setState({resizeHeight:parseInt(e.height),resizeWidth:parseInt(e.width)})}},{key:"handleFileInputChange",value:function(e){var t=e.target.files[0],i=URL.createObjectURL(t);this.insertImage(i)}},{key:"editor_style_callback",value:function(e,t){var i=this.getQueryVariable("mark");if("selected"==e){if(t){var r="curve";switch(t.shape){case 1:r="curve";break;case 3:r="rect";break;case 4:r="ellipse";break;case 7:r="callout";break;case 30:r="image";break;case 8:r="list";break;case 23:case 20:case 2:r="line_arrow";break;case 5:r="rect_blur";break;case 80:r="text"}this.setState({currentShape:r})}else this.setState({currentShape:""});if(this.state.changeShape)return void this.setState({changeShape:!1})}window.parent.postMessage({type:e,mark:i,data:t},"*")}},{key:"getQueryVariable",value:function(e){for(var t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var r=t[i].split("=");if(r[0]==e)return r[1]}return!1}},{key:"initEditor",value:function(e){if(e){this.container.current.style.position="absolute",this.container.current.style.setProperty("top",this.getQueryVariable("ct")+"px","important"),this.container.current.style.left=this.getQueryVariable("cl")+"px";var t=this,i=new Image;this.editor=new l.Z({out_container:this.outerContainer.current,container:this.container.current,doodle_canvas:this.doodleCanvas.current,layer_canvas:this.layerCanvas.current,textarea:this.textarea.current,textarea_out:this.textareaOut.current,$list_dialog:this.listDialog.current,image:i},(function(e,i){t.editor_style_callback(e,i)})),i.src=e,i.onload=function(){t.editor.setBgImage(i,!1),t.editor.setPenColor(t.state.currentColor),t.state.currentTool.length>0?t.editor.setPenType(t.state.currentTool):t.editor.setPenType("curve"),t.editor.setFontSize(t.state.currentFontSize),t.editor.setPenWidth(t.state.currentPenWidth),t.editor.setFontName(t.state.currentFontFamily),t.editor.setBlurRadius(30),t.setState({isReady:!0})}}}},{key:"insertImage",value:function(e){var t=this,i=new Image;i.src=e;var r={image:i,width:0,height:0,choose_type:"full"};i.img_info=r,i.onload=function(){r.width=this.naturalWidth,r.height=this.naturalHeight,t.editor.insertSvgImage(r)}}},{key:"handleToolBarBtnClick",value:function(e,t){var i=this.editor;if("shape"===e){if(-1!==o.indexOf(t)&&!this.props.permissions.allowAdvancedToolForImageEditor)return void this.setState({upgradeType:t,isShownUpgrade:!0});"highlight"==t?(i.unSelectAll(),i.setPenOpacity(.3),i.setPenWidth(16),i.setPenType("highlight")):(i.setPenOpacity(1),i.setPenWidth(this.state.currentPenWidth),i.setPenType(t)),this.setState({currentTool:t})}else if("action"===e)switch(t.actionType){case"crop":this.setState({isInCropMode:!0}),i.cutImage();break;case"changeColor":this.setState({currentColor:t.value}),i.setPenColor(t.value),localStorage["pen-color"]=t.value;break;case"changePenWidth":this.setState({currentPenWidth:t.value}),i.setPenWidth(parseInt(t.value)),localStorage["pen-width"]=t.value;break;case"changeFontSize":this.setState({currentFontSize:t.value}),i.setFontSize(parseInt(t.value)),localStorage["font-size"]=t.value;break;case"changeFontFamily":this.setState({currentFontFamily:t.value}),i.setFontName(t.value),localStorage["font-family"]=t.value;break;case"zoom-in":if(2!==this.state.currentScale){var r=this.state.currentScale+.25;i.setScale(r),this.setState({currentScale:r,isShowScaleTip:!0})}break;case"zoom-out":.25!==this.state.currentScale&&(r=this.state.currentScale-.25,i.setScale(r),this.setState({currentScale:r,isShowScaleTip:!0}));break;case"resetScale":i.setScale(1),this.setState({currentScale:1,isShowScaleTip:!1});break;case"crop-demension-width":this.setState({cropWidth:parseInt(t.value)},(function(){i.setCropSize(this.state.cropWidth,this.state.cropHeight)}));break;case"crop-demension-height":this.setState({cropHeight:parseInt(t.value)},(function(){i.setCropSize(this.state.cropWidth,this.state.cropHeight)}));break;case"leaveCrop":this.setState({isInCropMode:!1,cropWidth:0,cropHeight:0}),i.finishCutImage(!1);break;case"doCrop":i.finishCutImage(!0),this.setState({isInCropMode:!1,cropWidth:0,cropHeight:0});break;case"insert-image":if(!this.props.permissions.allowAdvancedToolForImageEditor)return void this.setState({upgradeType:"insertImage",isShownUpgrade:!0});this.fileInput.current.click();break;case"doInsertImage":if(!this.props.permissions.allowAdvancedToolForImageEditor)return void this.setState({upgradeType:"image",isShownUpgrade:!0});var a="./images/svg/"+t.value+".svg";this.insertImage(a);break;case"doResize":i.setImageSize(this.state.resizeWidth,this.state.resizeHeight);break;default:i[t.actionType]()}}},{key:"render",value:function(){var e=this.state,t=e.isShownUpgrade,i=(e.isReady,s()("editor",this.props.className));return(0,u.jsxs)("div",{className:i,tabIndex:"0",children:[(0,u.jsx)("input",{type:"file",className:"file-input",ref:this.fileInput,accept:".jpg,.jpeg,.png",onChange:this.handleFileInputChange}),(0,u.jsx)("div",{className:"editor-outer-container",tabIndex:"0",id:"editor-outer-container",ref:this.outerContainer,children:(0,u.jsxs)("div",{className:"editor-container",ref:this.container,children:[(0,u.jsx)("canvas",{className:"doodle-canvas",id:"canvas",ref:this.doodleCanvas}),(0,u.jsx)("canvas",{className:"layer-canvas",id:"canvas2",ref:this.layerCanvas}),(0,u.jsx)("div",{className:"editor-outer-textarea",ref:this.textareaOut,children:(0,u.jsx)("textarea",{className:"editor-textarea",ref:this.textarea})}),(0,u.jsxs)("div",{className:"editor-list-dialog",ref:this.listDialog,children:["Number:",(0,u.jsx)("input",{type:"number"})]})]})}),(0,u.jsx)(c.Z,{visible:t,onCancel:this.handleCloseUpgrade,type:this.state.upgradeType})]})}}])&&d(t.prototype,i),a&&d(t,a),h}(r.PureComponent);i(31795);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,r=P(e);if(t){var a=P(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return I(this,i)}}function I(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?x(e):t}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var C=chrome.extension.getBackgroundPage(),T=function(e){return"jpg"===e?"image/jpeg":"image/png"},R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(n,e);var t,i,r,a=k(n);function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=a.call(this,e)).onRef=function(e){t.child=e},t.state={annotateImageUrl:"",saveImageUrl:"",imageBlob:null,contentType:"image/png",permissions:{},step:"edit"},t.handleImageBlob=t.handleImageBlob.bind(x(t)),t.initEditor=t.initEditor.bind(x(t)),t.getQueryVariable=t.getQueryVariable.bind(x(t)),t.handleDrawStyleAction=t.handleDrawStyleAction,t}return t=n,(i=[{key:"handleDrawStyleAction",value:function(e){this.child.handleDrawStyle(e)}},{key:"initEditor",value:function(e){if(e){var t={annotateImageUrl:e};this.setState(t)}}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("message",(function(t){"init"==t.data.type?e.initEditor(t.data.dataUrl):e.handleDrawStyleAction(t.data.data)}));var t=this.getQueryVariable("mark");window.parent.postMessage({type:"initIframe",mark:t},"*")}},{key:"componentWillUnmount",value:function(){document.removeEventListener("visibilitychange",(function(){})),window.removeEventListener("message")}},{key:"handleImageBlob",value:function(e,t){var i=this.getQueryVariable("mark");if("copy"===e)window.parent.postMessage({type:"copy",mark:i,data:t},"*");else if("save"===e){var r=this.getQueryVariable("incognito"),a=this.getQueryVariable("actionType");"true"==r?chrome.runtime.sendMessage({action:"saveImage",data:t,actionType:a,format:T(this.getQueryVariable("format"))},(function(){})):C.saveAnnotatedImage(t,!0,a,T(this.getQueryVariable("format")))}}},{key:"getQueryVariable",value:function(e){for(var t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var r=t[i].split("=");if(r[0]==e)return r[1]}return!1}},{key:"render",value:function(){var e=s()("sub-page",{active:"edit"===this.state.step});return this.state.saveImageUrl||this.state.annotateImageUrl?(0,u.jsx)(v,{imageUrl:this.state.annotateImageUrl,handleFinishEdit:this.handleImageBlob,permissions:this.state.permissions,className:e,type:"ext",contentType:T(this.getQueryVariable("format")),onRef:this.onRef}):(0,u.jsx)("div",{className:"loading-page",children:(0,u.jsx)("div",{className:"center"})})}}])&&S(t.prototype,i),r&&S(t,r),n}(r.Component);a.render((0,u.jsx)(R,{}),document.getElementById("edit-page"))}},i={};function r(e){var a=i[e];if(void 0!==a)return a.exports;var n=i[e]={id:e,loaded:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}r.m=t,e=[],r.O=(t,i,a,n)=>{if(!i){var s=1/0;for(l=0;l<e.length;l++){for(var[i,a,n]=e[l],o=!0,c=0;c<i.length;c++)(!1&n||s>=n)&&Object.keys(r.O).every((e=>r.O[e](i[c])))?i.splice(c--,1):(o=!1,n<s&&(s=n));o&&(e.splice(l--,1),t=a())}return t}n=n||0;for(var l=e.length;l>0&&e[l-1][2]>n;l--)e[l]=e[l-1];e[l]=[i,a,n]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e+"../../"})(),(()=>{var e={512:0};r.O.j=t=>0===e[t];var t=(t,i)=>{var a,n,[s,o,c]=i,l=0;for(a in o)r.o(o,a)&&(r.m[a]=o[a]);for(c&&c(r),t&&t(i);l<s.length;l++)n=s[l],r.o(e,n)&&e[n]&&e[n][0](),e[s[l]]=0;r.O()},i=self.webpackChunkAwesomeScreenshot=self.webpackChunkAwesomeScreenshot||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),r.O(void 0,[394,377,347,514,894,366],(()=>r(11008)));var a=r.O(void 0,[394,377,347,514,894,366],(()=>r(40789)));a=r.O(a)})();